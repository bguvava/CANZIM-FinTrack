# Module 10: Reporting & Analytics Engine

## API Endpoints Documentation

**Base URL:** `/api/v1/reports`  
**Authentication:** Laravel Sanctum (Bearer Token)  
**Version:** 1.0.0  
**Last Updated:** November 19, 2025

---

## üìã Endpoints Overview

| Method | Endpoint                       | Description                  | Access  |
| ------ | ------------------------------ | ---------------------------- | ------- |
| GET    | `/reports`                     | Get report history           | PM, FO  |
| GET    | `/reports/{id}`                | Get report details           | PM, FO  |
| GET    | `/reports/{id}/download`       | Download report PDF          | PM, FO  |
| DELETE | `/reports/{id}`                | Delete report                | PM, FO  |
| POST   | `/reports/budget-vs-actual`    | Generate Budget vs Actual    | PM, FO  |
| POST   | `/reports/cash-flow`           | Generate Cash Flow           | PM, FO  |
| POST   | `/reports/expense-summary`     | Generate Expense Summary     | PM, FO  |
| POST   | `/reports/project-status`      | Generate Project Status      | PM only |
| POST   | `/reports/donor-contributions` | Generate Donor Contributions | PM only |
| POST   | `/reports/custom`              | Generate Custom Report       | PM, FO  |

**Legend:** PM = Programs Manager, FO = Finance Officer

---

## üîê Authentication

All endpoints require authentication via Laravel Sanctum bearer token:

```http
Authorization: Bearer {token}
```

**Obtaining a Token:**

```bash
POST /api/v1/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password"
}
```

---

## üìä Standard Response Format

### Success Response

```json
{
    "success": true,
    "message": "Report generated successfully.",
    "data": {
        "id": 1,
        "report_type": "budget-vs-actual",
        "title": "Budget vs Actual Report",
        "parameters": {},
        "file_path": "reports/abc123.pdf",
        "file_size": "125.5 KB",
        "status": "completed",
        "generated_by": {
            "id": 1,
            "name": "John Doe",
            "email": "john@example.com"
        },
        "created_at": "2024-11-19T10:30:00.000000Z",
        "updated_at": "2024-11-19T10:30:00.000000Z"
    }
}
```

### Error Response

```json
{
    "success": false,
    "message": "Validation failed.",
    "errors": {
        "start_date": ["The start date field is required."]
    }
}
```

---

## üìñ Endpoint Details

### 1. Get Report History

**Endpoint:** `GET /api/v1/reports`  
**Description:** Retrieve paginated list of reports generated by authenticated user  
**Authorization:** Programs Manager, Finance Officer

#### Query Parameters

| Parameter     | Type    | Required | Description                                   |
| ------------- | ------- | -------- | --------------------------------------------- |
| `page`        | integer | No       | Page number (default: 1)                      |
| `per_page`    | integer | No       | Items per page (default: 15, max: 100)        |
| `report_type` | string  | No       | Filter by report type                         |
| `status`      | string  | No       | Filter by status (completed, pending, failed) |

#### Request Example

```bash
GET /api/v1/reports?page=1&per_page=15&report_type=budget-vs-actual
Authorization: Bearer {token}
```

#### Response Example

```json
{
    "success": true,
    "data": {
        "data": [
            {
                "id": 5,
                "report_type": "budget-vs-actual",
                "title": "Budget vs Actual Report - November 2024",
                "parameters": {
                    "start_date": "2024-01-01",
                    "end_date": "2024-12-31",
                    "project_ids": [1, 2]
                },
                "file_path": "reports/uuid-here.pdf",
                "file_size": "234.8 KB",
                "status": "completed",
                "generated_by": {
                    "id": 1,
                    "name": "John Doe",
                    "email": "john@example.com"
                },
                "created_at": "2024-11-19T10:30:00.000000Z",
                "updated_at": "2024-11-19T10:30:00.000000Z"
            }
        ],
        "links": {
            "first": "http://example.com/api/v1/reports?page=1",
            "last": "http://example.com/api/v1/reports?page=3",
            "prev": null,
            "next": "http://example.com/api/v1/reports?page=2"
        }
    },
    "meta": {
        "current_page": 1,
        "last_page": 3,
        "per_page": 15,
        "total": 42
    }
}
```

---

### 2. Get Report Details

**Endpoint:** `GET /api/v1/reports/{id}`  
**Description:** Retrieve details of a specific report  
**Authorization:** Programs Manager, Finance Officer (own reports only)

#### Request Example

```bash
GET /api/v1/reports/5
Authorization: Bearer {token}
```

#### Response Example

```json
{
    "success": true,
    "data": {
        "id": 5,
        "report_type": "budget-vs-actual",
        "title": "Budget vs Actual Report - November 2024",
        "parameters": {
            "start_date": "2024-01-01",
            "end_date": "2024-12-31",
            "project_ids": [1, 2]
        },
        "file_path": "reports/uuid-here.pdf",
        "file_url": "http://example.com/storage/reports/uuid-here.pdf",
        "file_size": "234.8 KB",
        "status": "completed",
        "generated_by": {
            "id": 1,
            "name": "John Doe",
            "email": "john@example.com"
        },
        "created_at": "2024-11-19T10:30:00.000000Z",
        "updated_at": "2024-11-19T10:30:00.000000Z"
    }
}
```

---

### 3. Download Report PDF

**Endpoint:** `GET /api/v1/reports/{id}/download`  
**Description:** Download the generated PDF report  
**Authorization:** Programs Manager, Finance Officer (own reports only)

#### Request Example

```bash
GET /api/v1/reports/5/download
Authorization: Bearer {token}
```

#### Response

- **Content-Type:** `application/pdf`
- **Content-Disposition:** `attachment; filename="report-uuid.pdf"`
- **Body:** Binary PDF file

#### Error Responses

- **404 Not Found:** Report file does not exist
- **403 Forbidden:** User doesn't own this report

---

### 4. Delete Report

**Endpoint:** `DELETE /api/v1/reports/{id}`  
**Description:** Delete a report and its associated PDF file  
**Authorization:** Programs Manager, Finance Officer (own reports only)

#### Request Example

```bash
DELETE /api/v1/reports/5
Authorization: Bearer {token}
```

#### Response Example

```json
{
    "success": true,
    "message": "Report deleted successfully."
}
```

---

### 5. Generate Budget vs Actual Report

**Endpoint:** `POST /api/v1/reports/budget-vs-actual`  
**Description:** Generate a comparison report of budgeted vs actual expenses  
**Authorization:** Programs Manager, Finance Officer

#### Request Body

```json
{
    "start_date": "2024-01-01",
    "end_date": "2024-12-31",
    "project_ids": [1, 2, 3]
}
```

#### Validation Rules

| Field         | Type   | Required | Rules                                                   |
| ------------- | ------ | -------- | ------------------------------------------------------- |
| `start_date`  | string | Yes      | Valid date, before or equal to end_date                 |
| `end_date`    | string | Yes      | Valid date, after or equal to start_date, not in future |
| `project_ids` | array  | No       | Array of existing project IDs, max 5 items              |

#### Response Example

```json
{
    "success": true,
    "message": "Budget vs Actual report generated successfully.",
    "data": {
        "id": 6,
        "report_type": "budget-vs-actual",
        "title": "Budget vs Actual Report",
        "parameters": {
            "start_date": "2024-01-01",
            "end_date": "2024-12-31",
            "project_ids": [1, 2, 3]
        },
        "file_path": "reports/uuid-here.pdf",
        "file_size": "189.2 KB",
        "status": "completed",
        "generated_by": {
            "id": 1,
            "name": "John Doe",
            "email": "john@example.com"
        },
        "created_at": "2024-11-19T10:30:00.000000Z",
        "updated_at": "2024-11-19T10:30:00.000000Z"
    }
}
```

---

### 6. Generate Cash Flow Report

**Endpoint:** `POST /api/v1/reports/cash-flow`  
**Description:** Generate a cash flow analysis report  
**Authorization:** Programs Manager, Finance Officer

#### Request Body

```json
{
    "start_date": "2024-01-01",
    "end_date": "2024-12-31",
    "grouping": "month"
}
```

#### Validation Rules

| Field        | Type   | Required | Rules                                                   |
| ------------ | ------ | -------- | ------------------------------------------------------- |
| `start_date` | string | Yes      | Valid date, before or equal to end_date                 |
| `end_date`   | string | Yes      | Valid date, after or equal to start_date, not in future |
| `grouping`   | string | No       | One of: month, quarter, year                            |

#### Response Example

```json
{
    "success": true,
    "message": "Cash Flow report generated successfully.",
    "data": {
        "id": 7,
        "report_type": "cash-flow",
        "title": "Cash Flow Report",
        "parameters": {
            "start_date": "2024-01-01",
            "end_date": "2024-12-31",
            "grouping": "month"
        },
        "file_path": "reports/uuid-here.pdf",
        "file_size": "156.7 KB",
        "status": "completed",
        "generated_by": {
            "id": 1,
            "name": "John Doe",
            "email": "john@example.com"
        },
        "created_at": "2024-11-19T10:30:00.000000Z",
        "updated_at": "2024-11-19T10:30:00.000000Z"
    }
}
```

---

### 7. Generate Expense Summary Report

**Endpoint:** `POST /api/v1/reports/expense-summary`  
**Description:** Generate an expense summary grouped by category or project  
**Authorization:** Programs Manager, Finance Officer

#### Request Body

```json
{
    "start_date": "2024-01-01",
    "end_date": "2024-12-31",
    "group_by": "category",
    "category_ids": [1, 2, 3]
}
```

#### Validation Rules

| Field          | Type   | Required | Rules                                                   |
| -------------- | ------ | -------- | ------------------------------------------------------- |
| `start_date`   | string | Yes      | Valid date, before or equal to end_date                 |
| `end_date`     | string | Yes      | Valid date, after or equal to start_date, not in future |
| `group_by`     | string | No       | One of: category, project, month                        |
| `category_ids` | array  | No       | Array of existing category IDs, max 5 items             |

#### Response Example

```json
{
    "success": true,
    "message": "Expense Summary report generated successfully.",
    "data": {
        "id": 8,
        "report_type": "expense-summary",
        "title": "Expense Summary Report",
        "parameters": {
            "start_date": "2024-01-01",
            "end_date": "2024-12-31",
            "group_by": "category",
            "category_ids": [1, 2, 3]
        },
        "file_path": "reports/uuid-here.pdf",
        "file_size": "203.4 KB",
        "status": "completed",
        "generated_by": {
            "id": 1,
            "name": "John Doe",
            "email": "john@example.com"
        },
        "created_at": "2024-11-19T10:30:00.000000Z",
        "updated_at": "2024-11-19T10:30:00.000000Z"
    }
}
```

---

### 8. Generate Project Status Report

**Endpoint:** `POST /api/v1/reports/project-status`  
**Description:** Generate a detailed project status and financial report  
**Authorization:** Programs Manager only

#### Request Body

```json
{
    "project_id": 1,
    "start_date": "2024-01-01",
    "end_date": "2024-12-31"
}
```

#### Validation Rules

| Field        | Type    | Required | Rules                                                   |
| ------------ | ------- | -------- | ------------------------------------------------------- |
| `project_id` | integer | Yes      | Existing project ID                                     |
| `start_date` | string  | Yes      | Valid date, before or equal to end_date                 |
| `end_date`   | string  | Yes      | Valid date, after or equal to start_date, not in future |

#### Response Example

```json
{
    "success": true,
    "message": "Project Status report generated successfully.",
    "data": {
        "id": 9,
        "report_type": "project-status",
        "title": "Project Status Report",
        "parameters": {
            "project_id": 1,
            "start_date": "2024-01-01",
            "end_date": "2024-12-31"
        },
        "file_path": "reports/uuid-here.pdf",
        "file_size": "278.9 KB",
        "status": "completed",
        "generated_by": {
            "id": 1,
            "name": "John Doe",
            "email": "john@example.com"
        },
        "created_at": "2024-11-19T10:30:00.000000Z",
        "updated_at": "2024-11-19T10:30:00.000000Z"
    }
}
```

---

### 9. Generate Donor Contributions Report

**Endpoint:** `POST /api/v1/reports/donor-contributions`  
**Description:** Generate a report of donor contributions and funding  
**Authorization:** Programs Manager only

#### Request Body

```json
{
    "start_date": "2024-01-01",
    "end_date": "2024-12-31",
    "donor_ids": [1, 2]
}
```

#### Validation Rules

| Field        | Type   | Required | Rules                                                   |
| ------------ | ------ | -------- | ------------------------------------------------------- |
| `start_date` | string | Yes      | Valid date, before or equal to end_date                 |
| `end_date`   | string | Yes      | Valid date, after or equal to start_date, not in future |
| `donor_ids`  | array  | No       | Array of existing donor IDs, max 5 items                |

#### Response Example

```json
{
    "success": true,
    "message": "Donor Contributions report generated successfully.",
    "data": {
        "id": 10,
        "report_type": "donor-contributions",
        "title": "Donor Contributions Report",
        "parameters": {
            "start_date": "2024-01-01",
            "end_date": "2024-12-31",
            "donor_ids": [1, 2]
        },
        "file_path": "reports/uuid-here.pdf",
        "file_size": "167.3 KB",
        "status": "completed",
        "generated_by": {
            "id": 1,
            "name": "John Doe",
            "email": "john@example.com"
        },
        "created_at": "2024-11-19T10:30:00.000000Z",
        "updated_at": "2024-11-19T10:30:00.000000Z"
    }
}
```

---

### 10. Generate Custom Report

**Endpoint:** `POST /api/v1/reports/custom`  
**Description:** Generate a custom report with user-defined parameters  
**Authorization:** Programs Manager, Finance Officer

#### Request Body

```json
{
    "title": "Custom Financial Analysis Q4 2024",
    "description": "Quarterly analysis of expenses and budget utilization",
    "parameters": {
        "start_date": "2024-10-01",
        "end_date": "2024-12-31"
    }
}
```

#### Validation Rules

| Field         | Type   | Required | Rules                                |
| ------------- | ------ | -------- | ------------------------------------ |
| `title`       | string | Yes      | Max 255 characters                   |
| `description` | string | No       | Max 1000 characters                  |
| `parameters`  | object | Yes      | Must contain start_date and end_date |

#### Response Example

```json
{
    "success": true,
    "message": "Custom report generated successfully.",
    "data": {
        "id": 11,
        "report_type": "custom",
        "title": "Custom Financial Analysis Q4 2024",
        "parameters": {
            "description": "Quarterly analysis of expenses and budget utilization",
            "start_date": "2024-10-01",
            "end_date": "2024-12-31"
        },
        "file_path": "reports/uuid-here.pdf",
        "file_size": "145.6 KB",
        "status": "completed",
        "generated_by": {
            "id": 1,
            "name": "John Doe",
            "email": "john@example.com"
        },
        "created_at": "2024-11-19T10:30:00.000000Z",
        "updated_at": "2024-11-19T10:30:00.000000Z"
    }
}
```

---

## ‚ùå Common Error Responses

### 401 Unauthorized

```json
{
    "message": "Unauthenticated."
}
```

### 403 Forbidden

```json
{
    "success": false,
    "message": "This action is unauthorized."
}
```

### 404 Not Found

```json
{
    "success": false,
    "message": "Report not found."
}
```

### 422 Validation Error

```json
{
    "success": false,
    "message": "Validation failed.",
    "errors": {
        "start_date": ["The start date field is required."],
        "end_date": ["The end date cannot be in the future."],
        "project_ids": ["You can select a maximum of 5 projects."]
    }
}
```

### 500 Internal Server Error

```json
{
    "success": false,
    "message": "An error occurred while processing your request."
}
```

---

## üß™ Testing with cURL

### Generate Budget vs Actual Report

```bash
curl -X POST http://localhost/api/v1/reports/budget-vs-actual \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "start_date": "2024-01-01",
    "end_date": "2024-12-31",
    "project_ids": [1, 2]
  }'
```

### Get Report History

```bash
curl -X GET "http://localhost/api/v1/reports?page=1&per_page=15" \
  -H "Authorization: Bearer {token}"
```

### Download Report

```bash
curl -X GET http://localhost/api/v1/reports/5/download \
  -H "Authorization: Bearer {token}" \
  --output report.pdf
```

---

## üìù Notes

- All dates must be in `Y-m-d` format (e.g., `2024-11-19`)
- Maximum of 5 filter IDs per request (project_ids, category_ids, donor_ids)
- End date cannot be in the future
- Users can only access their own generated reports
- PDF files are stored in `storage/app/public/reports/` directory
- File sizes are automatically calculated and formatted (KB, MB)

---

**Last Updated:** November 19, 2025  
**API Version:** 1.0.0
